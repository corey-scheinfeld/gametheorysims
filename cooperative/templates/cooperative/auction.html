{% extends "global/Page.html" %}
{% load otree %}
{% block title %}
    Cooperative Bargaining
{% endblock %}

{% block content %}

<div class="card bg-light instructions">
    <div class="card-body">
        <h3>
            Auction
        </h3>
        <link rel="stylesheet" type="text/css"
              href="{% static 'global/matrix.css' %}"/>


          On this page, you will bargain with your partner to determine a lottery tickert distribution. Once again, your lottery prize for winning is {{player.lottery_value}}. You may either offer a ticket split, or accept one sent to you. You have 5 minutes.
          <br><br>

          <style>
            .wrap {
              border-style: groove;
              border-width: 10px;
              padding: 5px;
              background-color: 'grey';
              border-color: 'black';
              font-weight: bold;
          </style>

          <strong> LATEST PROPOSAL: </strong><br><br>
          <p  id="proposal" class ='wrap'>
          <br>
          No current proposals.
          <br><br>
          </p>
          <br>
          <p>Do you wish to accept the offer?</p>
          <div>
            <button name="offer_accepted" id="accept" type = "button">Yes</button>
            <button id="next"></button>

          </div>
          <script>
            document.getElementById('accept').onclick = function (){
              liveSend('game_finished');
            };
          </script>

          <br><br>

          <strong> Send a lottery ticket split offer: </strong><br><br>

          I receive <input id="give" type="number" > tickets and you recieve <input id="keep" type="number"> tickets.   <button type="button" id="sendbutton">Send</button>
          </div.
    </div>

          {% endblock %}

          {% block scripts %}
          <script>

            let history = document.getElementById('history');
            let give = document.getElementById('give');
            let keep = document.getElementById('keep');
            let sendbutton = document.getElementById('sendbutton');


            function liveRecv(data){
              console.log(liveRecv)
              if (data == 'game_finished'){
                  document.getElementById("next").click();
                  }
              if(data == 'error'){
                  window.alert("Lottery split not equal to 100 total tickets!");
                }
              else{
              document.getElementById("proposal").innerHTML = 'NEW PROPOSAL! \n Player two offered a lottery ticket split of ' + data[0]+'/'+data[1]+', meaning player two would keep '+data[0]+' tickets, and that you would Receive '+data[1]+' tickets.';
            }


            }
              sendbutton.onclick = function (){
                  console.log(liveSend)
                  liveSend([give.value, keep.value]);
                }
        </script>
{% endblock %}
